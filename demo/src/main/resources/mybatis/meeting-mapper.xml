<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="meeting">

    <!-- 정모 번호 시퀀스 조회 -->
    <select id="sequence" resultType="long">
        SELECT meeting_seq.NEXTVAL FROM dual
    </select>
    
    <!-- 정모 추가 -->
    <insert id="insert" parameterType="meetingDto">
        INSERT INTO meeting (
            meeting_no,
            meeting_crew_no,
            meeting_owner_no,
            meeting_name,
            meeting_date,
            meeting_location,
            meeting_price,
            meeting_limit
        ) VALUES (
            #{meetingNo},
            #{meetingCrewNo},
            #{meetingOwnerNo},
            #{meetingName},
            #{meetingDate},
            #{meetingLocation},
            #{meetingPrice},
            #{meetingLimit}
        )
    </insert>

    <!-- 정모 수정 -->
    <update id="update" parameterType="meetingDto">
        UPDATE meeting
        SET meeting_name = #{meetingName},
            meeting_date = #{meetingDate},
            meeting_location = #{meetingLocation},
            meeting_price = #{meetingPrice},
            meeting_limit = #{meetingLimit}
        WHERE meeting_no = #{meetingNo}
    </update>

    <!-- 정모 삭제 -->
    <delete id="delete" parameterType="long">
        DELETE FROM meeting
        WHERE meeting_no = #{meetingNo}
    </delete>

    <!-- 정모 이미지 조회 -->
    <select id="findImage" resultType="long">
        SELECT attachment_no FROM meeting_image
        WHERE meeting_no = #{meetingNo}
    </select>
    
    <!-- 정모 이미지 연결 -->
    <insert id="connect">
        INSERT INTO meeting_image (meeting_no, attachment_no)
        VALUES (#{meetingNo}, #{attachmentNo})
    </insert>
    
    <!-- 특정 정모 상세 조회 -->
    <select id="selectVO" resultType="meetingVO" parameterType="long">
	    SELECT
	        m.meeting_no,
	        m.meeting_crew_no,
	        m.meeting_owner_id,
	        m.meeting_name,
	        m.meeting_date,
	        m.meeting_location,
	        m.meeting_price,
	        m.meeting_limit,
	        mi.attachment_no
	    FROM meeting m
	    LEFT JOIN meeting_image mi ON m.meeting_no = mi.meeting_no
	    WHERE m.meeting_no = #{meetingNo}
	</select>
    
     <!-- 전체 정모 목록 조회 -->
<!--    <select id="selectList" resultType="meetingDto">-->
<!--        select-->
<!--    		meeting_no,-->
<!--            meeting_crew_no,-->
<!--            meeting_owner_no,-->
<!--            meeting_name,-->
<!--            meeting_date,-->
<!--            meeting_location,-->
<!--            meeting_price,-->
<!--            meeting_limit-->
<!--       	from meeting-->
<!--        order by crew_no desc-->
<!--    </select>-->

</mapper>
